#!/bin/bash

echo "compile in progress ..."

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

echo "BUILD_DIR: $BUILD_DIR"
echo "CACHE_DIR: $CACHE_DIR"
echo "ENV_DIR: $ENV_DIR"

CARGO=~/.cargo/bin/cargo

echo "-----> Install cargo"
if [ -x $CARGO ]; then
    echo "cargo already installed"
else
    curl https://sh.rustup.rs -sSf > rustup.sh
    chmod u+x rustup.sh
    ./rustup.sh -y
fi
$CARGO --version

echo "-----> Compile the application"
cd "$BUILD_DIR" && \
    $CARGO clean && \   # clean residual files from previous builds
    $CARGO build --release
