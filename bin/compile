#!/bin/bash

echo "compile in progress ..."

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

echo "BUILD_DIR: $BUILD_DIR"
echo "CACHE_DIR: $CACHE_DIR"
echo "ENV_DIR: $ENV_DIR"

CARGO=~/.cargo/bin/cargo

echo "-----> Install cargo"
if [ -x $CARGO ]; then
    echo "cargo already installed"
else
    curl https://sh.rustup.rs -sSf > rustup.sh
    chmod u+x rustup.sh
    ./rustup.sh -y --default-toolchain minimal
    rm rustup.sh
fi
$CARGO --version

echo "-----> Compile the application"
$CARGO build --release --manifest-path "$BUILD_DIR/Cargo.toml"

pwd
ls -la "$BUILD_DIR"
du -sh "$BUILD_DIR"
du -h "$BUILD_DIR"
